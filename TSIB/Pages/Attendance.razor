@page "/attendance"
@using System.Globalization

<h4>Asistencia</h4>
@if (Attendances == null || AttendanceTypes == null)
{
    <div class="spinner"></div>
}
else
{
    <div class="card">
        <div class="card-header">
            <div class="form-group row">
                <label for="monthId" class="col-sm-2 col-form-label">
                    Mes
                </label>
                <div class="col-sm-4">
                    @* this select must be configurable *@
                    <select class="form-control form-control-sm" name="Mes" id="monthId" @bind-value="Month" @bind-value:event="oninput">
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6">Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>

                <label for="yearId" class="col-sm-2 col-form-label">
                    Año
                </label>

                <div class="col-sm-4">
                    @* this select must be configurable *@
                    <select class="form-control form-control-sm" name="Año" id="yearId" @bind-value="Year" @bind-value:event="oninput">
                        <option value="2015">2015</option>
                        <option value="2016">2016</option>
                        <option value="2017">2017</option>
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                        <option value="2021">2021</option>
                        <option value="2022">2022</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                        <option value="2033">2033</option>
                        <option value="2034">2034</option>
                        <option value="2035">2035</option>
                        <option value="2036">2036</option>
                        <option value="2037">2037</option>
                        <option value="2038">2038</option>
                        <option value="2039">2039</option>
                        <option value="2040">2040</option>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label for="employeeId" class="col-sm-2 col-form-label">
                    Empleado
                </label>
                <div class="col-sm-4">
                    <select style="padding-left:0; padding-right:0; border-left:0; border-right:0; border:none; outline:0px;" class="form-control form-control-sm" name="EmployeeId" id="employeeId" @bind-value="EmployeeId" @bind-value:event="oninput">
                        <option value="0">Todos</option>
                        @foreach (var employee in Employees)
                        {
                            <option value="@employee.EmployeeId">@employee.FirstName @employee.LastName</option>
                        }
                    </select>
                </div>
            </div>


            <div class="form-group row d-flex justify-content-between">
                <div>
                    <button class="btn btn-primary btn-sm" @onclick="AttendanceSearch_Click"><span class="oi oi-magnifying-glass" aria-hidden="true"></span> Buscar</button>
                </div>
            </div>

        </div>

        <div class="card-body">
            <table class="table table-hover table-sm table-bordered table-fixed" style="overflow-y: scroll;">
                <thead>
                    <tr>
                        <th scope="col" style="font-family: Arial, Helvetica, sans-serif; width:100px;">Nombre&nbsp;del&nbsp;Empleado</th>

                        @for (int i = 1; i <= Days; i++)
                        {
                            <th scope="col">@i</th>
                        }

                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th scope="row"></th>

                        @for (int i = 1; i <= Days; i++)
                        {
                            <th scope="col">
                                @(
                            new CultureInfo("Es-Es").DateTimeFormat.GetDayName(new DateTime(Convert.ToInt32(YearSearch), Convert.ToInt32(MonthSearch), i).DayOfWeek).Substring(0, 3)
                        )
                            </th>
                        }

                    </tr>


                    @foreach (var attendance in AttendancesViewModel)
                    {
                        <tr>
                            <th scope="row" style="font-size: 13px; padding-bottom:0px; padding-top:0px;">@attendance.EmployeeName</th>

                            @for (int i = 1; i < attendance.Attendance.Length; i++)
                            {

                                int iDay = i;
                                <td style="padding-left:0; padding-right:0; padding-bottom:0px; padding-top:0px;">

                                    <select style="width:50px; padding-left:0; padding-right:0; border-left:0; border-right:0;" class="form-control form-control-sm" name="AttendanceType" id="attendanceTypeId" @bind-value="attendance.Attendance[iDay]" @bind-value:event="oninput" @onchange="(() => SaveAttenndace_Click(attendance, Convert.ToInt32(Year), Convert.ToInt32(Month), iDay))">
                                        @foreach (var attendanceType in AttendanceTypes)
                                        {
                                            <option value="@attendanceType.AttendanceTypeId">@attendanceType.ShortDescription</option>
                                        }
                                    </select>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
